{% load static %}

<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@3.0.7/marked.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/npm/@antv/g2@4.1.10/dist/g2.min.js"></script>


</head>


<body> 
    <header>
        <a href="#" class="logo"><i class="fas-fa-untensiles"></i>深度学习模型安全评估平台</a>
        
        <nav class="navbar">
                <a href="/index">首页</a></li>
                <a href="/cv" class="active">图像模型</a></li>
                <a href="/nlp">语言模型</a></li>
                <a href="/audio">语音模型</a></li>
        </nav>

    </header>
    <script>
       
    </script>
    <aside class="sidebar">
        <h3>首页</h3>
        <ul>
            <li><a href="#introduction"  class="active">使用说明</a></li>
            <li><a href="#backdoor" > 对抗样本</a></li>
            <li><a href="#setting" >参数设定</a></li>
            <li><a href="#report" >生成报告</a></li>

        </ul>
    </aside>
    <!-- introduction section starts -->
    <section class="introduction" id="introduction">
        <h1 class="section-title">使用说明</h1>
        <div class="introduction-container">
            <div class="markdown-content" id="markdown-content">
            </div>
        </div>
    </section>
    
    <section class="setting" id="setting">
        <h1 class="section-title">上传模型参数（目前仅支持 DeepSpeech 结构的模型）</h1>
        <div class="setting-container">
            <div class="upload-box">
                    <input type="file" name="model" id="model" accept=".pth,.pt,.ckpt">
                    <button type="submit" id="upload-button">上传</button>
            </div>
        </div>

        <h1 class="section-title">设置参数</h1>
        <div class="setting-container">
            <form action="/audio_setting/" method="post">
                {% csrf_token %}
               
                    <div class="setting-box ">
                        <ul>
                            <li>
                                <label for="model">模型</label>
                                <select id="model" name="model">
                                    <option value= "librispeech_pretrained_v3">librispeech_pretrained_v3</option>
                                    <option value="an4_pretrained_v3">an4_pretrained_v3</option>
                                    <option value="ted_pretrained_v3">ted_pretrained_v3</option>
                                </select>
            
                            </li>
                            <li>
                                <label for="dataset">对抗目标</label>
                                <input type="text" id="dataset" name="dataset" placeholder="对抗目标">
                            </li>
                            
                            <li>
                                <label>对抗样本攻击算法</label>
                                <div id="back">
                                    <label><input type="checkbox" name="back" value="fgsm"> FGSM</label>
                                    <label><input type="checkbox" name="back" value="pgd"> PGD</label>
                                    <label><input type="checkbox" name="back" value="genetic"> Genetic</label>
                                    <label><input type="checkbox" name="back" value="cw"> CW</label>
                                    <label><input type="checkbox" name="back" value="icw"> ICW</label>
                                </div>
                            </li>

                            <li>
                                
                                <button type="submit" id="confirm-button">确认参数</button>
                            </li>
                        </ul>
                    
                    </div>
              
            
                  
            </form>  
        </div>
        
    </section>

    <section class="report" id="report">
        <h1 class="section-title">结果总览</h1>
        <div id="audio-result"></div>
    </section>
    <script>
        const data = [
        { model: 'librispeech_pretrained_v3', algorithm: 'FGSM', successRate: 0, pNormDistance: 8.5593, score: 91.5914 },
        { model: 'librispeech_pretrained_v3', algorithm: 'PGD', successRate: 80, pNormDistance: 3.1502, score: 28.5762 },
        {model:'librispeech_pretrained_v3', algorithm: 'Genetic', successRate: 100, pNormDistance: 0.0000, score: 0.0000},
        ];

        // 创建条形图
        const chart1 = new G2.Chart({
        container: 'container1',
        width: 800,
        height: 600,
        });
        chart1.data(data);
        chart1.scale({
        successRate: { min: 0, max: 100 },
        pNormDistance: { min: 0 },
        });
        chart1.interval().position('algorithm*successRate').color('model');
        chart1.interval().position('algorithm*pNormDistance').color('model');
        chart1.render();

        // 创建雷达图
        const chart2 = new G2.Chart({
        container: 'container2',
        width: 800,
        height: 600,
        });
        chart2.data(data);
        chart2.coordinate('polar');
        chart2.line().position('model*score').color('algorithm');
        chart2.point().position('model*score').color('algorithm');
        chart2.render();
    </script>
    <script>
        // 首先，获取你想要添加点击事件的按钮
        var button = document.querySelector('button[id="setting-button"]');

        // 然后，获取你想要切换隐藏和显示的元素
        var settingBox2 = document.querySelectorAll('.setting-box-2');

        // 添加点击事件监听器
        button.addEventListener('click', function() {
            // 遍历所有的.setting-box-2元素
            settingBox2.forEach(function(box) {
                // 切换隐藏和显示
                box.classList.toggle('hidden');
            });
        });
    </script>
    <script>
        // 获取所有的section元素和侧边栏的链接元素
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.sidebar a');

        // 创建一个Intersection Observer
        const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
            // 当section元素进入视口时，找到对应的侧边栏链接
            const id = entry.target.getAttribute('id');
            const navLink = document.querySelector(`.sidebar a[href="#${id}"]`);
            // 添加一个类来改变侧边栏链接的显示
            navLink.classList.add('active');
            // 移除其他链接的active类
            navLinks.forEach((link) => {
                if (link !== navLink) {
                link.classList.remove('active');
                }
            });
            }
        });
        }, { threshold: 0.1 });  // 当section元素的10%进入视口时，触发回调函数

        // 使用Intersection Observer来观察所有的section元素
        sections.forEach((section) => {
        observer.observe(section);
        });
    </script>
    <!-- <footer>
        <p>&copy; 2020 All rights reserved</p>
    </footer> -->
  
    <script>
        document.getElementById('upload-form').addEventListener('submit', function(event) {
            event.preventDefault();
        
            var formData = new FormData();
            var fileField = document.querySelector("#model");
        
            formData.append('model', fileField.files[0]);
            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
        
            fetch('/audio_upload/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // 处理返回的数据
                console.log(data);
            })
            .catch(error => {
                // 处理错误
                console.error(error);
            });
        F
        }, false);
        </script>

        <script src="{% static 'js/index.js' %}"></script>
        <script>
            $(document).ready(function() {
            $('.sidebar a').on('click', function(e) {
                e.preventDefault();

                // Remove active class from all links
                $('.sidebar a').removeClass('active');
                // Add active class to the clicked link
                $(this).addClass('active');

                // Hide all sections
                $('section').hide();
                // Show the clicked section
                var section = $(this).attr('href');
                $(section).show();
            });
        });

        </script>
</html>

